title: 'Akira Ransomware: Shadow Copy Deletion'
id: e4f8a1f6-9c4c-4a16-834c-6a7e283b5f9e
status: experimental
description: Detects command-line execution of tools like vssadmin, wmic, and bcdedit
  to delete Volume Shadow Copies or inhibit system recovery functions. This is a common
  precursor to ransomware encryption, as used by groups like Akira.
references:
- https://attack.mitre.org/techniques/T1490/
- https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-353a
author: Automated Detection Agent
date: '2024-07-31'
modified: '2024-08-01'
tags:
- attack.impact
- attack.t1490
logsource:
  product: windows
  service: process_creation
  category: process_creation
detection:
  selection:
    vssadmin:
      Image|endswith: \vssadmin.exe
      CommandLine|contains|all:
      - delete
      - shadows
    wmic:
      Image|endswith: \wmic.exe
      CommandLine|contains|all:
      - shadowcopy
      - delete
    bcdedit_recovery:
      Image|endswith: \bcdedit.exe
      CommandLine|contains|all:
      - /set
      - recoveryenabled
      - 'no'
    bcdedit_boot:
      Image|endswith: \bcdedit.exe
      CommandLine|contains|all:
      - /set
      - bootstatuspolicy
      - ignoreallfailures
  filter_legitimate:
    CommandLine|contains: list shadows
  condition: 1 of selection.* and not filter_legitimate
falsepositives:
- Legitimate, albeit highly unusual, administrative scripts that clear shadow copies
  for maintenance.
- Use of these commands by backup software during uninstallation or major reconfiguration.
level: high
fields:
- ComputerName
- User
- Image
- ParentImage
- CommandLine
test_scenarios:
  true_positive: A script executes `vssadmin.exe delete shadows /all /quiet` to prevent
    recovery.
  false_negative: Attacker uses a PowerShell cmdlet like `Remove-ComputerRestorePoint`
    or direct WMI calls, which do not create these process events.
  false_positive: A system administrator runs `vssadmin.exe list shadows` to check
    the status of volume snapshots.
  true_negative: A user launches a standard application like 'notepad.exe'.
  log_source_schema: https://github.com/SigmaHQ/sigma/wiki/Log-Sources#process-creation
  example_log_fields:
    EventID: '4688'
    Image: C:\Windows\System32\vssadmin.exe
    CommandLine: vssadmin.exe delete shadows /all /quiet
    ParentImage: C:\Windows\System32\cmd.exe
